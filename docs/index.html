<!-- HTML header for doxygen 1.8.9.1
Converted manually by Andy Dent to be HTML 5 instead of XHTML
-->
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
        "http://www.w3.org/TR/1999/REC-html401-19991224/loose.dtd">
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8" />
<meta http-equiv="X-UA-Compatible" content="IE=9" />
<meta name="generator" content="Doxygen 1.8.13" />
<link rel="icon" href="https://realm.io/img/favicon.ico" />
<link rel="apple-touch-icon-precomposed" sizes="57x57" href="https://realm.io/img/favicon-57x57.png" />
<link rel="apple-touch-icon-precomposed" sizes="114x114" href="https://realm.io/img/favicon-114x114.png" />
<link rel="apple-touch-icon-precomposed" sizes="72x72" href="https://realm.io/img/favicon-72x72.png" />
<link rel="apple-touch-icon-precomposed" sizes="144x144" href="https://realm.io/img/favicon-144x144.png" />
<link rel="apple-touch-icon-precomposed" sizes="120x120" href="https://realm.io/img/favicon-120x120.png" />
<link rel="apple-touch-icon-precomposed" sizes="152x152" href="https://realm.io/img/favicon-152x152.png" />
<link rel="icon" type="image/png" href="https://realm.io/img/favicon-32x32.png" sizes="32x32" />
<link rel="icon" type="image/png" href="https://realm.io/img/favicon-16x16.png" sizes="16x16" />
<title>SushiHangover.RealmThread: Main Page</title>
<link href="tabs.css" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript">
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-50247013-1', 'auto');
  ga('send', 'pageview');
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="extra.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="icon.png" /></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">SushiHangover.RealmThread
   </div>
   <div id="projectbrief">An Action/Task Message Pump for running commands on a dedicated Realm thread.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',false,false,'search.php','Search');
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">SushiHangover.RealmThread Documentation</div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><div class="image">
<img src="https://raw.githubusercontent.com/sushihangover/RealmThread/master/media/SushiHangover.RealmThread.png" style="float: right;"/>
</div>
<h2><a class="el" href="class_sushi_hangover_1_1_realm_thread.html" title="A Realm Action Pump ">SushiHangover.RealmThread</a></h2>
<p><b>An Action/Task Message Pump for running commands on a dedicated Realm thread.</b></p>
<p><a href="https://gitter.im/RealmThread/Lobby?utm_source=badge&amp;utm_medium=badge&amp;utm_campaign=pr-badge&amp;utm_content=badge"></a> <a href="https://ci.appveyor.com/project/sushihangover/realmthread/branch/master"></a></p>
<h2>GitHub Repo</h2>
<p><a href="https://github.com/sushihangover/RealmThread">https://github.com/sushihangover/RealmThread</a></p>
<h2>API Documention</h2>
<p><a href="https://sushihangover.github.io/RealmThread/">https://sushihangover.github.io/RealmThread/</a></p>
<h2>Nuget:</h2>
<div class="nuget-badge"> </div><div class="nuget-badge"> <code> Install-Package <a class="el" href="class_sushi_hangover_1_1_realm_thread.html" title="A Realm Action Pump ">SushiHangover.RealmThread</a> </code> </div><div class="nuget-badge"> </div><p><b>Nuget.org:</b> <a href="https://www.nuget.org/packages/sushihangover.realmthread/">https://www.nuget.org/packages/sushihangover.realmthread/</a></p>
<h2>Issues?</h2>
<p>Post an <a href="https://github.com/sushihangover/RealmThread/issues">Issue</a> on Github</p>
<h2>Usage:</h2>
<h2>RealmThread:</h2>
<p>Instance a new <code>RealmThread</code> by passing a <code>RealmConfiguration</code>, either from an existing <code>Realm</code> instance (<code>Realm.Config</code>) or constructing one yourself. </p><pre class="fragment">var realmConfig = new RealmConfiguration("myRealm.db");
var realmThread = new RealmThread(realmConfig);
</pre><h2>IDisposable:</h2>
<p><code>RealmThread</code> implements <code>IDisposable</code> and to ensure data integrity call <code>Dispose</code> to ensure that all queued work on the dedicated Realm thread is completed. </p><pre class="fragment">using (var realmThread = new RealmThread(realmConfig))
{
    // Perform some work with the RealmThread
}
</pre><p><b>Or:</b> </p><pre class="fragment">var realmThread = new RealmThread(realmConfig);
// At some future point:
realmThread.Dispose();
</pre><h2><code>InvokeAsync</code>: Tasks and Continuations</h2>
<p>To ensure that <code>Task</code> <em>continuations</em> are performed on the same thread, use <code>InvokeAsync</code> when your Task contains other awaited Tasks, otherwise use <code>Invoke</code> or <code>BeginInvoke</code> to execute an <code>Action</code>.</p>
<p><b>Note:</b> This is a blocking call and will not return till all the queued items up till, including this one along with its continuations are executed. </p><pre class="fragment">await realmThread.InvokeAsync(async r =&gt;
{
    await Task.FromResult(true); // Simulate some Task, i.e. a httpclient request.... 
    // The following continuations will be executed on the proper thread
    r.Write(() =&gt;
    {
        var obj = r.CreateObject&lt;KeyValueRecord&gt;();
        obj.Key = "key";
    });
});
</pre><h2><code>BeginInvoke</code>: A Non-blocking Action:</h2>
<p><code>BeginInvoke</code> will queue an <code>Action</code> and immediately return (<code>Fire &amp; Forget</code>).</p>
<p><b>Note:</b> The items in the work queue are executed in the order they were queued (FIFO) and to mantain data integrity they can not be reordered once added. </p><pre class="fragment">realmThread.BeginInvoke(internalRealmOnThread =&gt;
{
    internalRealmOnThread.Write(() =&gt;
    {
        var obj = internalRealmOnThread.CreateObject&lt;KeyValueRecord&gt;();
        obj.Key = "key";
    });
});
</pre><h2><code>Invoke</code>: A Blocking Action:</h2>
<p><code>Invoke</code> will queue an <code>Action</code> and wait till it is executed.</p>
<p><b>Note:</b> The items in the work queue are executed in the order they were added, so until all the queued items up till and including this one are executed, this call will block. </p><pre class="fragment">realmThread.Invoke(internalRealmOnThread =&gt;
{
    internalRealmOnThread.Write(() =&gt;
    {
        var obj = internalRealmOnThread.CreateObject&lt;KeyValueRecord&gt;();
        obj.Key = "key";
    });
});
</pre><h2>Transaction Helpers</h2>
<p><code>RealmThread</code> has a built-in <code>Realms.Transaction</code> and a matching set of APIs that can be used instead of using a <code>Realms.Transaction</code> via a <em>captured</em> variable:</p>
<ul>
<li>Methods:<ul>
<li><code>BeginTransaction</code></li>
<li><code>CommitTransaction</code></li>
<li><code>RollbackTransaction</code></li>
</ul>
</li>
<li>Properties:<ul>
<li><code>InTransaction</code></li>
</ul>
</li>
</ul>
<h4>Example:</h4>
<pre class="fragment">realmThread.BeginTransaction();
realmThread.Invoke(r =&gt;
{
    var obj = r.CreateObject&lt;KeyValueRecord&gt;();
    obj.Key = "key";
});
if (realmThread.InTransaction)
{
    realmThread.CommitTransaction();
}
</pre><h4>**NOTE:** When a <code>RealmThread</code> object is disposed, if the built-in transaction is open, it will perform a **<code>Rollback</code>**. If you wish to override this behavoir, when creating a <code>RealmThread</code>, set the <code>autoCommit</code> parameter in the constructor to <code>true</code>.</h4>
<h2>Captured variables</h2>
<p>You can use captured variables within your <code>RealmThread</code>-based <code>Action</code> and <code>Task</code> to <em>pass</em> variables between the calling thread and the internal thread that <code>RealmThread</code> maintains a <code>Realm</code> instance on.</p>
<p>You can not pass a <b>managed</b> <code>RealmObject</code> or <code>RealmResult</code> in this manner as its access has to be made on the same thread it was instanced.</p>
<p>If needed, you could copy a <b>managed</b> <code>RealmObject</code> to a non-managed <code>RealmObject</code> and use this non-managed <code>RealmObject</code> variable as your captured variable that is passed between threads.</p>
<h3>Non-managed RealmObject amoung threads:</h3>
<pre class="fragment">var keyValueRecord = new KeyValueRecord();
realmThread.Invoke(r =&gt;
{
    var obj = r.ObjectForPrimaryKey&lt;KeyValueRecord&gt;(keyToFind);
    keyValueRecord.Key = obj.Key;
    keyValueRecord.Value = obj.Value;
});
Console.WriteLine($"{keyValueRecord.Key}:{keyValueRecord.Value}");
</pre><h3>Example of passing a Transaction:</h3>
<p><b>Note:</b> This was the primary way to control a <code>Transaction</code> over multiple invokes before the Transaction helper api was added. </p><pre class="fragment">Transaction trans = null;
realmThread.Invoke(r =&gt;
{
    trans = r.BeginWrite();
});
// Start a bunch of RealmObject inserts/edits
realmThread.Invoke(r =&gt;
{
    var obj = r.CreateObject&lt;KeyValueRecord&gt;();
    obj.Key = "key";
});
// Complete the transaction
t.Invoke(r =&gt;
{
    if (trans != null)
        trans.Commit();
});
</pre><h2>Parallel Write / Read Example:</h2>
<p>While this is a contrived example, it shows one <code>RealmThread</code> being used to only add records and another being used to read these new records.</p>
<p><b>Note:</b> The <code>toWrite</code> variable is a pre-populated <code>Dictionary&lt;string, byte[]&gt;</code>, see the performace tests in the source repo, within the <code>RealmThread.Tests.Shared</code> project, for creation details... </p><pre class="fragment">using (var blockingQueue = new BlockingCollection&lt;string&gt;())
using (var realmThreadWrite = new RealmThread(aRealmInstance.Config))
using (var realmThreadRead = new RealmThread(aRealmInstance.Config))
{
    Parallel.Invoke(() =&gt;
    {
        realmThreadWrite.Invoke(threadSafeWriteRealm =&gt;
        {
            foreach (var kvp in toWrite)
            {
                // Individual record write transactions so the other RealmThread can read asap
                threadSafeWriteRealm.Write(() =&gt;
                {
                    var obj = threadSafeWriteRealm.CreateObject(typeof(KeyValueRecord).Name);
                    obj.Key = kvp.Key;
                    obj.Value = kvp.Value;
                });
                blockingQueue.Add(kvp.Key);
            }
            blockingQueue.CompleteAdding();
        });
    },
    () =&gt;
    {
        realmThreadRead.Invoke((threadSafeReadRealm) =&gt;
        {
            foreach (var key in blockingQueue.GetConsumingEnumerable())
            {
                // Refresh() is automatically called at the beginning of each BeginInvoke/Invoke, 
                // so if we are within the RealmPump block and need to see the latest changes 
                // from other Realm instances, call Refresh manually
                threadSafeReadRealm.Refresh();
                var record = threadSafeReadRealm.ObjectForPrimaryKey&lt;KeyValueRecord&gt;(key);
                Assert.NotNull(record);
                Assert.Equal(key, record.Key);
            }
        });
    });
}
</pre><h2>Build from Source:</h2>
<p>From the cmd line using the amazing <a href="http://cakebuild.net">cake</a>: <a href="http://cakebuild.net"></a> </p><div class="code"> ./build.sh -t Build </div><h2>Build Documention:</h2>
<p>API Reference documention is built via the great <a href="http://www.doxygen.org/index.html"></a></p>
<div class="code"> doxygen Doxygen/realmthread.config </div><h2>Build Nuget Package:</h2>
<div class="code"> ./build.sh -t Package </div><h2>Publish Nuget:</h2>
<pre>
<div class="code">export NUGET_APIKEY={APIKEY}
export GITHUB_TOKEN={TOKEN/PASSWORD}
export GITHUB_USERNAME={EMAILADDRESS}
export NUGET_SOURCE=<a href="https://www.nuget.org/api/v2/package">https://www.nuget.org/api/v2/package</a>
./build.sh -t PublishPackages
</div>
</pre><center><sub>Thread Icon within the RealmThread Logo:</sub><br />
 <sub> Icons made by <a href="http://www.freepik.com" title="Freepik">Freepik</a> from <a href="http://www.flaticon.com" title="Flaticon">www.flaticon.com</a> is licensed by <a href="http://creativecommons.org/licenses/by/3.0/" title="Creative Commons BY 3.0" target="_blank">CC 3.0 BY</a> </sub></center><p>&lt;head&gt; &lt;style&gt; .nuget-badge code { -moz-border-radius: 5px; -webkit-border-radius: 5px; background-color: #202020; border: 4px solid silver; border-radius: 5px; box-shadow: 2px 2px 3px #6e6e6e; color: #e2e2e2; display: block; font: 1.0em 'andale mono', 'lucida console', monospace; line-height: 1.5em; overflow: auto; padding: 15px } .nuget-badge code::before { content: "PM&gt; " } .code { -moz-border-radius: 5px; -webkit-border-radius: 5px; background-color: #202020; border: 4px solid silver; border-radius: 5px; box-shadow: 2px 2px 3px #6e6e6e; color: #e2e2e2; display: block; font: 1.0em 'andale mono', 'lucida console', monospace; line-height: 1.5em; overflow: auto; padding: 15px }</p>
<p>&lt;/style&gt; &lt;/head&gt; </p>
</div></div><!-- contents -->
<!-- HTML footer for doxygen 1.8.9.1-->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>Â© 2016 SushiHangover\RobertN. All rights reserved.<br />
Generated by &#160;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen">
</a>
1.8.13
</small></address>
</body>
</html>
